Last updated `15/11/2023`
# LATEST FILE VERSIONS
- `categories_v5.py`
- `wbc_clean.py`
- `dedupe.py`

# PURPOSE
This project is to calculate categories of expenses based on a supplied .xlsx file and match to categories as defined in categories.xlsx

# PREREQUISITES
1. **Source data to be categorized**
This is an xls file containing data from
- WESTPAC - Di's account as it is used for some transactions
- ANZ credit card account
- CBA mortgage offset account
    - items such as strata and mortgage payment are deducted from here

# GETTING THE DATA
1. **Dianne's Westpac Account**
- Export the data since the last export
- Go to Account Activity -> Exports and Reports -> Transactions
- Select the Date Range, Account and CSV DD/MM/CCYY format (default)
- Save to: C:\Users\smaun\OneDrive\Documents\Data Analysis\Budget\RAW Exports\WBC - D Saker Personal
- Name with the export date a RAW in the filename
2. **ANZ Data**
- Select the Credit Card
- Select `Transactions`
- Select `Download` and specify a `Duration` and download
- Save to: C:\Users\smaun\OneDrive\Documents\Data Analysis\Budget\RAW Exports\ANZ
3. **CBA Data**
- Select the `Offset-1 Personal`
- Select a range for transactions via the `Date` dropdown
- Select `Export` (it is located just above the word `balance` above the first entry)
- Save to: C:\Users\smaun\OneDrive\Documents\Data Analysis\Budget\RAW Exports\CBA

## TRANSFORMING DATA ##
- As there is no error handling, the source file must be in the follwoing format
- Date, Amount, Description, Account

1. **Transform WBC Exports**
- The WBC file exports as a CSV with separate amounts for credits and debits as well as other columns
- Run the program `wbc_clean.py` to export a cleaned CSV file in the correct format
- The exported CSV contains column headings

2. **Transform ANZ Data**
- ANZ data does not require transforming but add Column D for the account identifier `ANZ`

3. **Transform CBA Data**
- Delete Column D in the CBA file (Total) and replace with the account identifier `CBA`

4. **Add all data to existing**
- File location:  
- Make a copy of the previous deduped xlsx and save as `Source update YYY-MM-DD.CSV`
- Copy and paste all data from the cleaned individual spreadsheets into a copy of the most recent deduped file
- Run `dedupe.py` from the `Data Cleaning` folder on this file. Check row counts before and after this just to check.
- File location:  C:\Users\smaun\OneDrive\Documents\Data Analysis\Budget\Source
- Save the duduped CSV file as an excel file `Source update YYY-MM-DD.XLSX`
- Rename the tab to `Sheet1`



3. **File Location**
The location of the data files is:  C:\Users\smaun\OneDrive\Documents\Data Analysis\Budget\Source
Filenames to select are:
    Source data to be categorized:    2021-10-10 to 2023-18-08 ANZ+CBA+WBC-DS.xlsx
    Categorization spreadsheet:     categories_V2.xlsx

Output locations:                   C:\Users\smaun\OneDrive\Documents\Data Analysis\Budget\Output







Proceedure:
Run the python file "categories_5.py"
Select the two files:
    1. Data Source
    2. categories_V2

# HOW DOES THE CODE WORK - gENERATED BY cHATgpt ON 15/11/2023
This code performs several operations to load, clean, and process financial data from Excel files using the `pandas` and `tkinter` libraries in Python. Here's a breakdown of its functionality:

1. **Importing Libraries**: The code imports necessary libraries like `pandas` for data manipulation, `tkinter` for graphical file selection, and `datetime` for timestamping.

2. **Function Definitions**:
    - `load_excel_file`: Opens a file dialog for the user to select an Excel file, then reads and returns a specified sheet from the file as a pandas DataFrame.
    - `clean_dataframe`: Cleans a DataFrame by converting strings to uppercase, removing non-alphanumeric characters and numeric characters from the 'Description' column, and replacing multiple spaces with a single space.
    - `split_and_assign_columns`: Splits the 'Amount' column into 'Credits' and 'Debits', assigns categories to each row based on the 'Description' column, and extracts year, month, and day from a 'Date' column. It also removes the original 'Amount' and 'Date' columns.
    - `assign_category`: Assigns a category to a given description based on a DataFrame of categories.
    - `clean_descriptions`: Cleans specific descriptions in the main DataFrame based on a 'cleanup' DataFrame.
    - `load_multiple_sheets`: Loads multiple sheets from an Excel file into separate DataFrames.
    - `save_dataframe`: Saves a DataFrame to an Excel file with a timestamp in the file name.

3. **Main Execution**: When the script is run directly (not imported as a module):
    - It loads a main financial data file.
    - Cleans this main DataFrame.
    - Loads 'Categories' and 'Cleanup' sheets from another Excel file.
    - Further cleans descriptions in the main DataFrame based on the 'Cleanup' DataFrame.
    - Assigns categories and splits columns in the main DataFrame.
    - Reorganizes the columns in a specified order.
    - Prints the first few rows of the cleaned DataFrame.
    - Generates a timestamp for file naming.
    - Saves the cleaned DataFrame to an Excel file in a specific path with the generated timestamp.

Overall, this script is designed for loading, cleaning, categorizing, and saving financial data from Excel files, useful in data analysis and financial record keeping.